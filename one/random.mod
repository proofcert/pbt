% How to "generate" random bits in Teyjus.
% We cheat and simply read the bits from a file.

module random.

% Two local predicates
type digitize          string -> int -> o.
type oracle_stream  in_stream -> o.

open_oracle_file FileName Goal :- % Problems with core dumps in Teyjus
  open_in FileName InStream, (oracle_stream InStream => Goal), close_in InStream.

open_oracle Name Goal :- Name String, open_string String InStream, 
                         (oracle_stream InStream => Goal), close_in InStream.

next_bit I :- oracle_stream InStream, input InStream 1 Bit,! , digitize Bit I.

digitize "0" 0.
digitize "1" 1.

test 1 [A,B,C]       :- open_oracle oracle1 (next_bit A, next_bit B, next_bit C).
test 2 [A,B,C]       :- open_oracle oracle2 (next_bit A, next_bit B, next_bit C).
test 3 [A,B,C,D,E,F] :- open_oracle oracle2 (next_bit A, next_bit B, next_bit C,
                                             next_bit D, next_bit E, next_bit F).

% Use oracle to pick a random integer between 0 and 127, inclusively.
read_7_bits R :- next_bit I0, next_bit I1, next_bit I2, next_bit I3,
                 next_bit I4, next_bit I5, next_bit I6,
                 R is I0 + I1 * 2 + I2 * 4 + I3 * 8 + I4 * 16 + I5 * 32 + I6 * 64.

%  T is (WL * 256) div (WL + WR),

oracle1 "110101010101010101010101".
oracle2 "11001101101010011010101".
oracle3 "101100".
oracle4 "101".
oracle5 "110101001010010101011101001000110101010010010010010001010101010100010101101101010101010001010".
% Five hundred random bits generated using =RANDBETWEEN(0,1) in a spreadsheet.
oracle6 "00000111000100001001001111101010101011101011010010011101001001000000001110010100101101000100000010010011011010110111111101011001111011110010101011110010000111001101010001111101011100011010000010000110101000110000100101100111101000010010111111010111000101011111010110010010011110101110011111111111010101001010111101000001100000101000000111101111110000100110110101001010110101010000111000101100011010011111100001001110000000011001111110110111000101000100101011011111001000000011011100100111110101110111".
% The following from https://catonmat.net/tools/generate-random-bits
oracle7 "0001010101110100111100111011101110110000110000010001101010100111100100101010111101101110101000101110010011110100000000000101111001011101101011010100011101101011100011010111100010001110010010101001011000000010111100100010001010100000000010100011101001000000".
% 2000 bits from website above
oracle8 "01110001010000100111100110111101111000001101011100110110010100101000000000101000101000001101111001100011101101111100010001100110111000010101000110011010111011101100011111000000101010000101010110100111101001000010000111100010010110011010110100101011000010011110010010100101011101010010011100101011011100111111001110101111110010110010101100010011110001110001110011001001101110001011001000111101111010001011001111011100101000001001010101010000001000100011100001100101101101011100011011010110101100111100011010010011001010100011111100010001010110010010100001011001010001001100000110111110111001001110001110000001110101110111101110000000001001001011100011011010110011101001111110110101001000000010001110011111111101001111101110000110001001100100111101001111111011011010001011000010001001100000010001111000111001110001001110000010110110111001110100100111100001001100111111001000111111110011100100110100101001000110110111010010111111000100110011010111100010110110000101010110011010000010100100011011110100011010100111011011101010010111111000011000110001110000110110111111010101010000110101000000010100110000101111111101000010010010010011100000100010111110100101101011110101100111001101101011111101010110001111100001111101110110000001100011000110101101100010001101011101100101101101010011110101011001110011011001011011110010010010111011110000010000000111011111011111101010010110110001111111100001010101101001110101011100100010101011100011001001110001010110010001000110111100101000010001000010110101110011110000001010011001110011111011110101101101111110101010100010100110101111010101100011011110111111011101001111010011111111111011010101000111010110110000101001010111011001001010110101100001111011100110111000000010010101110101001101110101100110100001000000101100111011111011000000101000000001000010010101011101110000000001011101011100110101111101101001000011000010001010001001100101001010010100100111111110101011011110010101100110011110110111111000111011000101111101101011001001111100101000111011110110111001".